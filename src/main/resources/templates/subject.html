<!DOCTYPE html>
<html th:replace="~{layout :: layout (~{:: main})}" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<body>

    <main>
        <div id="subject-info">
            <h1 th:text="${subject.name}"></h1>
            <p th:text="'Abreviação: ' + ${subject.abbreviation}"></p>
            <p>
                Código: <a th:href="@{/arquivo/{campusAbbr}/{courseNN}/{subjectAbbr}
                (campusAbbr=${subject.course.campus.abbreviation}, courseNN=${subject.course.normalizedName},
                subjectAbbr=${subject.abbreviation})}"
                           th:text="${subject.code}"></a>
            </p>
            <p>
                Curso: <a th:href="@{/arquivo/{campusAbbr}/{courseNN}(campusAbbr=${subject.course.campus.abbreviation},
            courseNN=${subject.course.normalizedName})}"
                   th:text="${subject.course.name} + ' (' + ${subject.course.campus.abbreviation} + ')'"></a>
            </p>
            <p>
                Professor(a): <a th:href="@{/arquivo/{campusAbbr}/docentes/{professorNN}
            (campusAbbr=${subject.course.campus.abbreviation}, professorNN=${subject.professor.normalizedName})}"
            th:text="${subject.professor.name}"></a>
            </p>
        </div>

        <div id="subject-reviews">
            <h3>Reviews:</h3>

            <div th:replace="~{fragments/subject-review-post-form :: subject-review-post-form}"></div>

            <div th:each="review: ${subject.reviews}" th:insert="~{fragments/subject-review :: subject-review(${review})}" th:remove="tag"></div>
            <p th:if="${subject.reviews.isEmpty()}" style="text-align: center; font-style: italic">Parece que ainda não há reviews para essa disciplina :/</p>


            <!-- The Delete Modal -->
            <div id="deleteReviewModal" class="modal">

                <!-- Modal content -->
                <div class="modal-content">
                    <div class="modal-header modal-header--delete">
                        <span class="close">&times;</span>
                        <p class="modal-title">Deseja mesmo deletar essa review?</p>
                    </div>
                    <div class="modal-body">
                        <p>Digite "deletar" (sem as aspas) no campo abaixo e pressione <b>Confirmar</b> para deletar a review.</p>
                        <form id="deleteReviewModalForm" th:action="@{/api/v1/reviews}">
                            <input id="delete-insurance" type="text" name="insurance" placeholder="deletar" required
                                   autocomplete="off">
                            <input type="hidden" id="deleteReviewId" name="reviewId" value="">
                            <button type="submit">Confirmar</button>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <p style="color: red; font-style: italic">Nota: essa ação não pode ser revertida!</p>
                    </div>
                </div>

            </div>


            <!-- The Modal -->
            <div id="editReviewModal" class="modal">

                <!-- Modal content -->
                <div class="modal-content">
                    <div class="modal-header modal-header--edit">
                        <span class="close">&times;</span>
                        <h2>Editar</h2>
                    </div>
                    <div class="modal-body">
                        <p style="color: red; font-style: italic">
                            Atenção! Editar sua review implicará nas seguintes consequências: <br/><br/>
                            - Remoção dos votos associados à review <br/>
                            - Atualização da data de postagem
                        </p>
                        <form id="editReviewModalForm" th:action="@{/api/v1/reviews}">
                            <label>
                                Título: <br/>
                                <input class="review-title" type="text" name="title">
                                <span class="subject-review-form__character-counter">0/50</span>
                            </label>
                            <label>
                                Conteúdo: <br/>
                                <textarea class="review-content" name="content" rows="10"></textarea>
                                <span class="subject-review-form__character-counter">0/1000</span>
                            </label>
                            <label>
                                Recomendação: <br/>
                                <select name="recommendation" required>
                                    <option disabled>--- Escolha uma opção ---</option>
                                    <option value="Recomendo">Recomendo</option>
                                    <option value="Neutro">Neutro</option>
                                    <option value="Não recomendo">Não recomendo</option>
                                </select>
                            </label>
                            <input type="hidden" id="editReviewId" name="reviewId" value="">
                            <div style="margin-top: 1rem">
                                <button type="button">Cancelar</button>
                                <button type="submit">Confirmar</button>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <p style="color: red; font-style: italic">Nota: essa ação não pode ser revertida!</p>
                    </div>
                </div>

            </div>
        </div>
        <script th:src="@{/js/subject.js}"></script>
        <script th:src="@{/js/subject-review-vote.js}"></script>
        <script th:src="@{/js/subject-review__options-dropdown.js}"></script>
    </main>

</body>
</html>